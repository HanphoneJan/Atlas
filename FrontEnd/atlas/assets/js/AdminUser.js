import{_ as e,r as a,u as t,c as l,x as n,a as s,o as u,e as r,w as o,j as i,p as c,h as d,i as p,q as m,D as v,k as _,E as f,G as g}from"./index.js";import{E as w}from"./api.js";const h=e({__name:"AdminUser",setup(e){const h=a([]),y=a(""),b=t().username,E=a(1),x=a(10),C=a(0),k=async()=>{try{const{data:e}=await _.get(w.GETUSER);830===e.status?(h.value=e.data,C.value=e.data.length):f.error("获取用户信息失败！")}catch(e){f.error("请求出错！")}},U=l((()=>{if(!y.value)return h.value;const e=new RegExp(y.value,"i");return h.value.filter((a=>e.test(a.nickname)||e.test(a.username)))})),j=l((()=>{const e=(E.value-1)*x.value;return U.value.slice(e,e+x.value)})),R=()=>{E.value=1,U.value=h.value.filter((e=>e.username.includes(y.value)))},T=e=>{E.value=e};return n(k),(e,a)=>{const t=d("el-input"),l=d("el-col"),n=d("el-button"),h=d("el-row"),U=d("el-table-column"),z=d("el-switch"),G=d("el-table"),S=d("el-pagination"),V=d("el-card");return u(),s("div",null,[r(V,{shadow:"never"},{default:o((()=>[r(h,{gutter:5},{default:o((()=>[r(l,{span:8},{default:o((()=>[r(t,{placeholder:"请输入用户名",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e)},null,8,["modelValue"])])),_:1}),r(l,{span:3},{default:o((()=>[r(n,{type:"primary",onClick:R},{default:o((()=>a[1]||(a[1]=[p("查找用户")]))),_:1})])),_:1})])),_:1}),r(G,{data:j.value,border:"",class:"user-table"},{default:o((()=>[r(U,{type:"index"}),r(U,{label:"用户名",prop:"username"}),r(U,{label:"邮箱",prop:"email","min-width":"100px"}),r(U,{label:"管理员","min-width":"70px"},{default:o((({row:e})=>[r(z,{"model-value":e.is_admin,"active-value":"1","inactive-value":"0",disabled:e.username===m(b),onChange:a=>(async(e,a)=>{const t=e.is_admin;e.is_admin=a;try{const{data:a}=await _.post(w.CHANGEUSER,{user:e});830!==a.status?(e.is_admin=t,f.error("修改权限失败")):f.success("修改权限成功")}catch(l){e.is_admin=t,f.error("请求出错！")}})(e,a)},null,8,["model-value","disabled","onChange"])])),_:1}),r(U,{label:"操作"},{default:o((({row:e})=>[r(n,{size:"small",type:"danger",icon:m(v),onClick:a=>(async e=>{try{await g.confirm("此操作将永久删除该用户, 是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0});const{data:a}=await _.post(w.DELETEUSER,{username:e});200!==a.code?f.error("删除用户失败！"):(f.success("删除用户成功！"),k())}catch(a){f.info("已取消删除")}})(e.username)},null,8,["icon","onClick"])])),_:1})])),_:1},8,["data"]),C.value>0?(u(),i(S,{key:0,"current-page":E.value,"page-size":x.value,total:C.value,layout:"total, prev, pager, next, jumper",onCurrentChange:T,class:"pagination-center"},null,8,["current-page","page-size","total"])):c("",!0)])),_:1})])}}},[["__scopeId","data-v-32b32c59"]]);export{h as default};
