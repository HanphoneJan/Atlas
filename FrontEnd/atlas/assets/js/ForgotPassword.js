import{d as e,r as a,a as l,b as o,e as s,n as r,w as u,h as t,T as d,o as i,i as m,t as n,E as p,k as c,l as v,_ as f}from"./index.js";import{E as g}from"./api.js";const w={class:"login-wrapper"},b={class:"login-container"},h={class:r(["sub-content"])},_={class:"img"},V={class:"form sign-up"},C={id:"captchaQuestion",style:{color:"black"}},y={class:"buttonWrapper"},k=f(e({__name:"ForgotPassword",setup(e){const r=v(),f=a({captcha:"",password:"",confirmPassword:"",email:"",emailCode:""}),k=()=>{const e=Math.floor(10*Math.random())+10,a=Math.floor(10*Math.random())+10;return{question:`${e} + ${a}`,answer:e+a}},q=a(k()),P=a(q.value.question),E=()=>{r.push("/login")},O={password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==f.value.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],emailCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},T=a(!1),U=a(null),D=e=>{e.preventDefault(),f.value={captcha:"",password:"",confirmPassword:"",email:"",emailCode:""}},I=()=>{T.value?p.warning("请稍后再试"):(T.value=!0,c.post(g.SENDVERICATIONCODE,{email:f.value.email}).then((e=>{830===e.data.status?(p.success("验证码已发送"),M()):(p.error("发送验证码失败"),T.value=!1)})).catch((e=>{p.error("发送验证码出错"),console.error("发送验证码出错",e.message),T.value=!1})))},M=()=>{U.value=setTimeout((()=>{T.value=!1}),6e4)},R=a(null),x=()=>{console.log(f.value),R.value.validate((e=>e?parseInt(f.value.captcha)!==q.value.answer?(p.error("验证码错误"),q.value=k(),void(P.value=q.value.question)):void c.post(g.FORGOTPASSWORD,{password:f.value.password,email:f.value.email,code:f.value.emailCode},{withCredentials:!0}).then((e=>{830===e.data.status?(p.success("重置密码成功，自动跳转登录界面"),r.push("/login")):(p.error("重置密码失败"),console.log("重置密码失败："+e.data.message))})).catch((e=>{p.error("重置密码出错"),console.error("重置密码失败："+e.message)})):(p.error("请正确填写信息"),!1)))};return(e,a)=>{const r=t("el-icon"),p=t("el-button"),c=t("el-input"),v=t("el-form-item"),g=t("el-form");return i(),l("div",w,[o("div",b,[o("div",h,[o("div",_,[a[6]||(a[6]=o("div",{class:"imgText m-up"},[o("h3",null,"返回登录页面"),o("p",null,"立即登录！")],-1)),s(p,{type:"primary",onClick:E,style:{"background-color":"#f08c4e"},id:"img_btn"},{default:u((()=>[s(r,null,{default:u((()=>a[5]||(a[5]=[m("登录 ")]))),_:1})])),_:1})])]),s(d,{name:"slide-register",mode:"out-in"},{default:u((()=>[o("div",V,[a[10]||(a[10]=o("h2",null,"找回密码",-1)),s(g,{model:f.value,rules:O,ref_key:"registerFormRef",ref:R,class:"form-content"},{default:u((()=>[s(v,{prop:"email",label:"邮箱"},{default:u((()=>[s(c,{modelValue:f.value.email,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.email=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),s(v,{prop:"password",label:"密码"},{default:u((()=>[s(c,{modelValue:f.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.password=e),type:"password",autocomplete:"off","show-password":""},null,8,["modelValue"])])),_:1}),s(v,{label:"确认密码",prop:"confirmPassword"},{default:u((()=>[s(c,{type:"password",modelValue:f.value.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.confirmPassword=e),autocomplete:"off","show-password":""},null,8,["modelValue"])])),_:1}),s(v,{label:"验证码",prop:"captcha"},{default:u((()=>[o("div",C,"请计算："+n(P.value),1),s(c,{modelValue:f.value.captcha,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value.captcha=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),s(v,{label:"邮箱验证码",prop:"emailCode"},{default:u((()=>[s(c,{modelValue:f.value.emailCode,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.emailCode=e),autocomplete:"off"},null,8,["modelValue"]),s(p,{onClick:I,disabled:T.value,id:"emailCode"},{default:u((()=>a[7]||(a[7]=[m("发送验证码")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"]),o("div",y,[s(p,{type:"primary",class:"submit",onClick:D},{default:u((()=>a[8]||(a[8]=[m("重置")]))),_:1}),s(p,{type:"primary",class:"submit",onClick:x},{default:u((()=>a[9]||(a[9]=[m("提交")]))),_:1})])])])),_:1})])])}}}),[["__scopeId","data-v-fb9675b0"]]);export{k as default};
