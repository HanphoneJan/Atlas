import{d as e,u as l,r as a,m as t,a as u,b as o,e as r,w as d,h as s,o as i,j as n,p as m,q as p,s as c,i as v,E as f,k as h,_}from"./index.js";import{E as g}from"./api.js";const V={class:"upload-wrapper"},b={class:"upload-container"},k=_(e({__name:"Upload",setup(e){const _=l(),k=a({title:"",author:"",description:""}),w=a([]),x=e=>{const l=e.type.startsWith("image/"),a=e.size/1024/1024<100;return l||f.error("只能上传图片文件!"),a||f.error("文件大小不能超过100MB!"),l&&a},E=a(!1),L=a([]),U=a(0),y=e=>{L.value=w.value.map((e=>e.url)),U.value=w.value.findIndex((l=>l.uid===e.uid)),E.value=!0},C=(e,l)=>{const a=w.value.findIndex((l=>l.uid===e.uid));-1!==a?(w.value.splice(a,1),f.success("文件删除成功")):f.warning("文件未找到")},j=()=>{if(!k.value.title||!k.value.author||!k.value.description)return void f.error("请填写所有必填项!");if(0===w.value.length)return void f.error("请上传至少一张图片!");if(w.value.length>10)return void f.error("一次性上传文件不能超过十张!");const e=new FormData;w.value.forEach((l=>{e.append("files[]",l.raw)})),console.log("formData:",k.value),e.append("title",k.value.title||"未命名"),e.append("author",k.value.author||"佚名"),e.append("description",k.value.description||"无"),e.append("username",_.username||"游客"),h.post(g.UPLOAD,e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{830===e.data.status?(f.success("提交成功"),D()):(f.error("提交失败"),console.log("提交失败:"+e.data.message))})).catch((e=>{f.error("提交出错"),console.error("提交出错:",e.message)}))},D=()=>{k.value.title="",k.value.author="",k.value.description="",w.value=[]};return t((()=>{"dark"===_.theme?(document.documentElement.classList.add("dark-theme"),document.documentElement.classList.remove("light-theme")):(document.documentElement.classList.remove("dark-theme"),document.documentElement.classList.add("light-theme"))})),(e,l)=>{const a=s("Plus"),t=s("el-icon"),f=s("el-upload"),h=s("el-form-item"),_=s("el-input"),g=s("el-button"),I=s("el-form");return i(),u("div",V,[o("div",b,[r(I,{ref:"uploadForm",model:k.value,"label-width":"120px"},{default:d((()=>[r(h,{label:"照片"},{default:d((()=>[r(f,{"list-type":"picture-card","on-preview":y,"on-remove":C,"file-list":w.value,"onUpdate:fileList":l[0]||(l[0]=e=>w.value=e),"before-upload":x,"auto-upload":!1},{default:d((()=>[r(t,null,{default:d((()=>[r(a)])),_:1})])),_:1},8,["file-list"]),E.value?(i(),n(p(c),{key:0,"url-list":L.value,"initial-index":U.value,onClose:l[1]||(l[1]=e=>E.value=!1)},null,8,["url-list","initial-index"])):m("",!0)])),_:1}),r(h,{label:"照片名字"},{default:d((()=>[r(_,{modelValue:k.value.title,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value.title=e),placeholder:"请输入照片名字"},null,8,["modelValue"])])),_:1}),r(h,{label:"照片作者"},{default:d((()=>[r(_,{modelValue:k.value.author,"onUpdate:modelValue":l[3]||(l[3]=e=>k.value.author=e),placeholder:"请输入照片作者"},null,8,["modelValue"])])),_:1}),r(h,{label:"照片说明"},{default:d((()=>[r(_,{modelValue:k.value.description,"onUpdate:modelValue":l[4]||(l[4]=e=>k.value.description=e),placeholder:"请输入照片说明"},null,8,["modelValue"])])),_:1}),r(h,null,{default:d((()=>[r(g,{onClick:j},{default:d((()=>l[5]||(l[5]=[v("提交")]))),_:1}),r(g,{onClick:D},{default:d((()=>l[6]||(l[6]=[v("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-56047f4e"]]);export{k as default};
